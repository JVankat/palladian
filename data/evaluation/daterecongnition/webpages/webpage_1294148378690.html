<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-local" xml:lang="en-local">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
 <title>Linux:  Unreliable Guide To Locking | KernelTrap</title>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/files/foundation_favicon.ico" type="image/x-icon" />
 <link type="text/css" rel="stylesheet" media="all" href="/files/css/css_259b056e5724024716602f9592e74628.css" />
 <script type="text/javascript" src="/files/js/js_fde24ce2164b1dc872140d8e018e0c28.js"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, {"basePath":"\/","user_relationships_ui":{"loadingimage":"\/sites\/default\/modules\/user_relationships\/user_relationships_ui\/images\/loadingAnimation.gif","savingimage":"\/sites\/default\/modules\/user_relationships\/user_relationships_ui\/images\/savingimage.gif","position":{"position":"absolute","left":"0","top":"0"}}});
//--><!]]>
</script>
 <script type="text/javascript"> </script>
</head>
<body class="not-front not-logged-in page-node node-type-story one-sidebar sidebar-right" >

  <div id="header">
    <h1>
            <a href="/"><img src="/files/foundation_logo.png" alt="Home" class="logo" /></a>
      
      
          </h1>

    
    
    <div id="block-block-11" class="block block-block">
    <div class="title">login</div>
  
  <div class="content"><a href="/user/login">Login</a> / <a href="/user/register">Register</a></div>
</div>

<div id="block-search-0" class="block block-search">
    <div class="title">Search</div>
  
  <div class="content"><form action="/node/1776"  accept-charset="UTF-8" method="post" id="search-block-form">
<div><div class="container-inline">
  <div class="form-item" id="edit-search-block-form-1-wrapper">
 <label for="edit-search-block-form-1">Search this site: </label>
 <input type="text" maxlength="128" name="search_block_form" id="edit-search-block-form-1" size="15" value="" title="Enter the terms you wish to search for." class="form-text" />
</div>
<input type="submit" name="op" id="edit-submit-1" value="Search"  class="form-submit" />
<input type="hidden" name="form_build_id" id="form-e087d1d01b2886811d2646478d7226fb" value="form-e087d1d01b2886811d2646478d7226fb"  />
<input type="hidden" name="form_id" id="edit-search-block-form" value="search_block_form"  />
</div>

</div></form>
</div>
</div>

<div id="block-block-12" class="block block-block">
  
  <div class="content"><p>&nbsp;<br />
&nbsp;</p>
</div>
</div>

  </div>

  <!-- Navigation Lists -->
  <div id="navcontainer">
  <ul id="navlist">
  <li><a href="/forum" title="Forums">Forums</a></li>
  <li><a href="/news" title="News">News</a></li>
  <!-- <li><div id="menu-jobs"><a href="/jobs" title="Jobs">Jobs</a></div></li> -->
  <li><a href="/blogs" title="Blogs">Blogs</a></li>
  <li><a href="/features" title="Features">Features</a></li>
  <!-- <li><a href="/man" title="Man Pages">Man Pages</a></li> -->
  <li><a href="/site" title="Site">Site</a></li>
  </ul>
  </div>


  <div id="container" class="clear-block">
    
    <div id="page"><div class="wrapper">
            <div class="breadcrumb"><a href="/">Home</a></div>      
      
      
      
            <h2 class="title">Linux:  Unreliable Guide To Locking</h2>
      
      
      
      <div id="node-1776" class="node node-story">
  
  
    <div class="author">Submitted by <a href="/user/1" title="View user profile.">Jeremy</a></div>
  <div class="date">on December 12, 2003 - 5:56am</div>
  
  <div class="terms"><ul class="links inline"><li class="taxonomy_term_216 first"><a href="/documentation" rel="tag" title="">documentation</a></li>
<li class="taxonomy_term_243"><a href="/HOWTO" rel="tag" title="">HOWTO</a></li>
<li class="taxonomy_term_187"><a href="/Linux" rel="tag" title="">Linux</a></li>
<li class="taxonomy_term_718"><a href="/taxonomy/term/718" rel="tag" title="">locking</a></li>
<li class="taxonomy_term_340"><a href="/Rusty_Russell" rel="tag" title="">Rusty Russell</a></li>
<li class="taxonomy_term_2 last"><a href="/news/linux" rel="tag" title="">Linux news</a></li>
</ul></div>

  <div class="content"><p>Rusty Russell [<a href="http://kerneltrap.org/node/view/892">interview</a>] recently posted an updated version of his "<a href="http://www.kernel.org/pub/linux/kernel/people/rusty/kernel-locking/" target="new">Unreliable Guide To Locking</a>".  The introduction begins:</p>
<blockquote><p>"<i>Welcome, to Rusty's Remarkably Unreliable Guide to Kernel Locking issues. This document describes the locking systems in the Linux Kernel in 2.6. With the wide availability of HyperThreading, and preemption in the Linux Kernel, everyone hacking on the kernel needs to know the fundamentals of concurrency and locking for SMP. </i>"</p></blockquote>
<p>Rusty's excellent guide is quite informative, helping the reader to grasp concurrency, explaining the common types of locks, providing useful examples, listing common problems, discussing locking speed, and much more.  All in all, it's an essential reference.</p>
<hr />
<pre>
<b>From: <a href="/node/view/892">Rusty Russell</a></b> [email blocked]
To:  linux-kernel
Subject: [PATCH] Update Documentation/DocBook/kernel-locking.tmpl
Date: Thu, 11 Dec 2003 19:57:03 +1100

This has needed doing for a while.  Reviews welcome. 

As an attachment because it's about 64k "raw".

Cheers,
Rusty.

<br />
From: "Randy.Dunlap" [email blocked]
Subject: Re: [PATCH] Update Documentation/DocBook/kernel-locking.tmpl
Date: Thu, 11 Dec 2003 20:00:55 -0800

| 
| This has needed doing for a while.  Reviews welcome. 
| 
| As an attachment because it's about 64k "raw".


Some could be fuser errors (with docbook stylesheets etc.)...


a.  uses "gloss-timer" and "gloss-timers": choose one

b.  docbook complained about many unclosed or unmatched instances
    of &lt;/sect1&gt;, &lt;/chapter&gt;, &lt;/listitem&gt;, etc.

c.  docbook complains about some 'C' syntactic items that are
inside &lt;LiteralLayout&gt; or &lt;programlisting&gt;.  E.g.:

- 'cache' in
	list_for_each_entry(i, &amp;cache, list)

- 'obj-' in
	list_del(&amp;obj-&gt;list);

- 'cache_lock' in
	down(&amp;cache_lock);

(see the pattern: '&amp;' shouldn't be special inside these blocks,
or at least that's how I think about it, but the software disagrees)


- docbook (at least my version) dislikes these #includes:
 #include &lt;linux/list.h&gt;
 #include &lt;linux/slab.h&gt;
 #include &lt;linux/string.h&gt;
+#include &lt;linux/rcupdate.h&gt;
 #include &lt;asm/semaphore.h&gt;
 #include &lt;asm/errno.h&gt;


I'd read it for content soonish.

Thanks for the update.

--
~Randy

<br />
<b>From: <a href="/node/view/892">Rusty Russell</a></b> [email blocked]
Subject: Re: [PATCH] Update Documentation/DocBook/kernel-locking.tmpl 
Date: Fri, 12 Dec 2003 17:04:00 +1100

In message &lt;20031211200055.778ca906.rddunlap@osdl.org&gt; you write:
&gt; | 
&gt; | This has needed doing for a while.  Reviews welcome. 
&gt; | 
&gt; | As an attachment because it's about 64k "raw".
&gt; 
&gt; 
&gt; Some could be fuser errors (with docbook stylesheets etc.)...

Yes, I fixed all these, but I sent out the old one (I'd fixed the
..sgml file, not the .tmpl file!).

Here's take II.  See also:
<a href="http://www.kernel.org/pub/linux/kernel/people/rusty/kernel-locking/" target="new">http://www.kernel.org/pub/linux/kernel/people/rusty/kernel-locking/</a>

Thanks,
Rusty.
--
  Anyone who quotes me in their sig is an idiot. -- Rusty Russell.
</pre><hr />
<pre>
<b>From: <a href="/node/view/892">Rusty Russell</a></b> [email blocked]
Subject: [DOCUMENTATION] Revised Unreliable Kernel Locking Guide
Date: Fri, 12 Dec 2003 16:24:18 +1100

OK, I've put the html version up for your reading pleasure: the diff
is quite extensive and hard to read.

<a href="http://www.kernel.org/pub/linux/kernel/people/rusty/kernel-locking/" target="new">http://www.kernel.org/pub/linux/kernel/people/rusty/kernel-locking/</a>

Feedback welcome,
Rusty.
--
  Anyone who quotes me in their sig is an idiot. -- Rusty Russell.
</pre><hr />
<b>Related Links:</b>
<ul>
<li><a href="http://marc.theaimsgroup.com/?t=107113346700001&amp;r=1&amp;w=2" target="new">Archive of above thread</a>
</li><li><a href="http://kerneltrap.org/node/view/892">KernelTrap interview with Rusty Russell</a>
</li></ul>
</div>

  <div class="links"><ul class="links inline"><li class="comment_add first last"><a href="/comment/reply/1776#comment-form" title="Share your thoughts and opinions related to this posting.">Add new comment</a></li>
</ul></div>
</div>

<div id="comments">
  <a id="comment-5540"></a>
<div id="comment-5540" class="comment">
    <h4 class="title">
    <a href="/node/1776#comment-5540" class="active">Source code checking</a>      </h4>
  
  
    <div class="author">Anonymous</div>
  <div class="on">on</div>
  <div class="date">December 12, 2003 - 8:42am</div>
  
  <div class="content"><p>I am very unfamiliar with the kernel and the tools used, so this may be a stupid question - is there any source code checker for the Kernel that would do a 'super lint'. This would be a tool that checks the code for potential locking issues may exist. It would also check to and unsafe code that may suffer form memory leaks or buffer overruns. I am guessing that you would need to add 'pragmas' around code that is preempt-able, or perhaps the other way - code that could not be pre-empted.</p>
</div>

  <div class="links"><ul class="links"><li class="comment_reply first last"><a href="/comment/reply/1776/5540">reply</a></li>
</ul></div>
</div>

<div class="indented"><a id="comment-5543"></a>
<div id="comment-5543" class="comment">
    <h4 class="title">
    <a href="/node/1776#comment-5543" class="active">moof</a>      </h4>
  
  
    <div class="author">Anonymous</div>
  <div class="on">on</div>
  <div class="date">December 12, 2003 - 9:51am</div>
  
  <div class="content"><p>preempt_enable() and preempt_disable()</p>
</div>

  <div class="links"><ul class="links"><li class="comment_reply first last"><a href="/comment/reply/1776/5543">reply</a></li>
</ul></div>
</div>

<a id="comment-5545"></a>
<div id="comment-5545" class="comment">
    <h4 class="title">
    <a href="/node/1776#comment-5545" class="active">Yes</a>      </h4>
  
  
    <div class="author">Anonymous</div>
  <div class="on">on</div>
  <div class="date">December 12, 2003 - 12:22pm</div>
  
  <div class="content"><p>There's a tool like that. The people that maintain it run it on the Linux kernel every so often and send a bunch of information to the lkml. It's a university group that does it but I can't recall which one at the moment...possibly Stanford.</p>
</div>

  <div class="links"><ul class="links"><li class="comment_reply first last"><a href="/comment/reply/1776/5545">reply</a></li>
</ul></div>
</div>

<div class="indented"><a id="comment-5550"></a>
<div id="comment-5550" class="comment">
    <h4 class="title">
    <a href="/node/1776#comment-5550" class="active">Checker</a>      </h4>
  
  
    <div class="author">Anonymous</div>
  <div class="on">on</div>
  <div class="date">December 12, 2003 - 2:22pm</div>
  
  <div class="content"><p>Howdy</p>
<p>It`s indeed called the "Stanford Checker".</p>
</div>

  <div class="links"><ul class="links"><li class="comment_reply first last"><a href="/comment/reply/1776/5550">reply</a></li>
</ul></div>
</div>

</div></div><a id="comment-5544"></a>
<div id="comment-5544" class="comment">
    <h4 class="title">
    <a href="/node/1776#comment-5544" class="active">Erm, Confused Newbie Here ....</a>      </h4>
  
  
    <div class="author">Anonymous</div>
  <div class="on">on</div>
  <div class="date">December 12, 2003 - 11:50am</div>
  
  <div class="content"><p>Sorry this is off topic but -<br />
<br /><br />
<br /><br />
<quote>"Anyone who quotes me in their sig is an idiot. -- Rusty Russell."</quote><br />
<br /><br />
<br /><br />
The only person quoting Rusty Russell in their sig seems to be Rusty Russell. Surely this is taking self deprecation a step too far ?<br />
<br /><br />
<br /><br />
O.K, O.K., I`ll leave you to flame me now while I scamper back to Kernel Newbies.  ;-)<br />
<br /></p>
</div>

  <div class="links"><ul class="links"><li class="comment_reply first last"><a href="/comment/reply/1776/5544">reply</a></li>
</ul></div>
</div>

<div class="indented"><a id="comment-5554"></a>
<div id="comment-5554" class="comment">
    <h4 class="title">
    <a href="/node/1776#comment-5554" class="active">Not for an Australian it isn&#039;t.</a>      </h4>
  
  
    <div class="author">Anonymous</div>
  <div class="on">on</div>
  <div class="date">December 12, 2003 - 5:12pm</div>
  
  <div class="content"><p>Rusty is providing a perfect example of it with his sig.</p>
</div>

  <div class="links"><ul class="links"><li class="comment_reply first last"><a href="/comment/reply/1776/5554">reply</a></li>
</ul></div>
</div>

<a id="comment-5555"></a>
<div id="comment-5555" class="comment">
    <h4 class="title">
    <a href="/node/1776#comment-5555" class="active">re: Erm, Confused Newbie Here ....</a>      </h4>
  
  
    <div class="author"><a href="/user/1" title="View user profile.">Jeremy</a></div>
  <div class="on">on</div>
  <div class="date">December 12, 2003 - 6:03pm</div>
  
  <div class="content"><p><quote>Surely this is taking self deprecation a step too far ?</quote></p>
<p>For what it's worth, Rusty gives the history behind his sig early on in <a href="http://kerneltrap.org/node/view/892">this interview</a>.</p>
</div>

  <div class="links"><ul class="links"><li class="comment_reply first last"><a href="/comment/reply/1776/5555">reply</a></li>
</ul></div>
</div>

</div><form action="/node/1776"  accept-charset="UTF-8" method="post" id="comment-controls">
<div><div class="box">
    <h3 class="title">Comment viewing options</h3>
  
  <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-c1b6a4e5d60215f88ea13006ba17bb3e" value="form-c1b6a4e5d60215f88ea13006ba17bb3e"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4" selected="selected">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50" selected="selected">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
</div>

</div></form>
</div>
    </div></div>

        <div id="right-sidebar" class="sidebar"><div id="block-author_pane-0" class="block block-author_pane">
    <div class="title">Author Information</div>
  
  <div class="content">
<div class="author-pane">
 <div class="author-pane-inner">
    <div class="author-pane-name-status author-pane-section">
      <div class="author-pane-line author-name"> <a href="/user/1" title="View user profile.">Jeremy</a> </div>

      
              <div class="picture">
  <a href="/user/1" title="View user profile."><img src="http://kerneltrap.org/files/pictures/picture-1.jpg" alt="Jeremy&#039;s picture" title="Jeremy&#039;s picture"  /></a></div>
      
      <div class="author-pane-line author-pane-online">
        <span class="author-pane-online-icon"><img src="/sites/default/modules/author_pane/images/user-offline.png" alt="User offline. Last seen 1 week 4 days ago." title="User offline. Last seen 1 week 4 days ago." width="16" height="16" /></span>
        <span class="author-pane-online-status">Offline</span>
      </div>

            
      
          </div>

    <div class="author-pane-stats author-pane-section">
              <div class="author-pane-line author-joined">
          <span class="author-pane-label">Joined:</span> Oct 13 2001        </div>
      
      
      
          </div>

    <div class="author-pane-admin author-pane-section">
      
      
              
    </div>

    <div class="author-pane-contact author-pane-section">
      
      
      
            
          </div>
  </div>
</div>
</div>
</div>

<div id="block-user_relationship_blocks-user-3" class="block block-user_relationship_blocks">
    <div class="title">Jeremy's friends</div>
  
  <div class="content"><div class="item-list"><ul><li class="first"><a href="/user/7167" title="View user profile.">strcmp</a></li>
<li class="last"><a href="/user/2687" title="View user profile.">mariuz</a></li>
</ul></div></div>
</div>

<div id="block-user-1" class="block block-user">
    <div class="title">Navigation</div>
  
  <div class="content"><ul class="menu"><li class="collapsed first"><a href="/node/add">Create content</a></li>
<li class="leaf"><a href="/mailarchive">Mailing list archives</a></li>
<li class="leaf last"><a href="/tracker">Recent posts</a></li>
</ul></div>
</div>

<div id="block-block-14" class="block block-block">
  
  <div class="content"><script type='text/javascript'> var ab_h = '8aa26477aad489ceb1b7f5b77c0ef554'; var ab_s = 'a43d276e40890adee87f8fdb259fb608';</script><script type='text/javascript' src='http://cdn1.adbard.net/js/ab2.js'></script></div>
</div>

<div id="block-block-4" class="block block-block">
  
  <div class="content"><center><small>Colocation donated by:</small><br /><a href="http://osuosl.org/"><img src="/files/pictures/thumbnail_small.gif" /></a></center></div>
</div>

<div id="block-node-0" class="block block-node">
    <div class="title">Syndicate</div>
  
  <div class="content"><a href="/node/feed" class="feed-icon"><img src="/misc/feed.png" alt="Syndicate content" title="Syndicate" width="16" height="16" /></a></div>
</div>

</div>
      </div>

  <div id="footer">
    <a href="">&copy; 2001-2009 KernelTrap.</a> &nbsp;|&nbsp; Powered by <a href="http://www.drupal.org/">Drupal</a>. &nbsp;|&nbsp; <a href="">Legal statement.</a>      </div>

  <div id="user_relationships_popup_form" class="user_relationships_ui_popup_form"></div></body>
</html>

